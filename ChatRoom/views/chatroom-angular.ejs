<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>	
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
</head>


<body >
	<div ng-app="chatApp" ng-controller="chatCtrl">
		
		<!--<h2 ng-hide='startChat'>Please enter your nickname.</h2>-->

		<form class="form-inline text-center " ng-hide='startChat'>
		  <br><br><br><br><br><br>	
		  <h2>Nickname</h2>
		  <br>
		  <div class="form-group">
		    <input ng-model='nickname' placeholder='Anonymous' ng-keypress='nameEnter($event)' class="form-control">
		  </div>
		  <button type='button' ng-click='login()' class="btn btn-default">click</button>
		</form>

		<form class="form-inline text-center " ng-show='startChat'>
			<br><br>
			<h2 >Hello {{nickname }} !!</h2>
			<textarea ng-model='msgPool'  id='message' 
				readonly="readonly" cols='120' rows='20' style=" OVERFLOW:auto; COLOR:#999; padding:10px" >
			</textarea>
			<input ng-model='msgInput' type='text' size=105 ng-keypress="pressEnter($event)" class="form-control">
			<button ng-model='msgBtn' ng-click='sendMsg()' class="btn btn-default">SEND</button>
			<!--<button ng-model='msgBtn' ng-click='startChat=false'>LogOut</button>-->
		</form>




	</div>

	<script>
		var socket = io.connect();

		var app = angular.module("chatApp", []);

		app.controller("chatCtrl", function($scope) {
			$scope.startChat = false;
			$scope.msgPool = '';
			$scope.msgInput = '';
			$scope.nickname = '';

		    $scope.login = function(){
		    	if($scope.nickname.length==0)
		    		window.alert("Please enter your nickname");
		    	else
		    		$scope.startChat = true;
		    }

		    $scope.sendMsg = function(){	
		    	if($scope.msgInput.length!=0){
			    	socket.emit('client_data', {
			            'msg': $scope.nickname+': '+$scope.msgInput+'\n'
			          });
			    	$scope.msgInput = '';  
		    	}
		    }

		    $scope.pressEnter = function(keyEvent) {
		  		if (keyEvent.which === 13)
		  			$scope.sendMsg();
			}

			$scope.nameEnter = function(keyEvent){
				if (keyEvent.which === 13)
		  			$scope.login();
			}

			socket.on('message', function(data) {
				$scope.msgPool = $scope.msgPool+data.msg;
				$scope.test = $scope.msgPool+data.msg;
				$scope.$apply();
             	var scrollTop = $("#message")[0].scrollHeight;  
                $("#message").scrollTop(scrollTop); 
      		});

      		socket.on('first', function(data){
      			$scope.msgPool = $scope.msgPool+data.msg;
      			$scope.$apply();
      			var scrollTop = $("#message")[0].scrollHeight;  
                $("#message").scrollTop(scrollTop); 
			});

		});

	</script>

	<!--
	<script src="chatApp"></script>
	<script src="chatCtrl"></script>
	-->
</body>
</html>
